@model List<CafeWebsite.Models.Product>
@{
    ViewData["Title"] = "Quản lý sản phẩm";
}

<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Quản lý sản phẩm</h1>
        </div>

        <!-- Navigation -->
        <div class="mb-8">
            <nav class="flex space-x-4">
                <a asp-action="Dashboard" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">Dashboard</a>
                <a asp-action="Products" class="bg-amber-600 text-white px-4 py-2 rounded-lg">Sản phẩm</a>
                <a asp-action="Orders" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300">Đơn hàng</a>
            </nav>
        </div>

        @if (TempData["Success"] != null)
        {
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                <div class="flex">
                    <i data-lucide="check-circle" class="h-5 w-5 text-green-400"></i>
                    <p class="ml-3 text-sm text-green-700">@TempData["Success"]</p>
                </div>
            </div>
        }

        @if (TempData["Error"] != null)
        {
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                <div class="flex">
                    <i data-lucide="alert-circle" class="h-5 w-5 text-red-400"></i>
                    <p class="ml-3 text-sm text-red-700">@TempData["Error"]</p>
                </div>
            </div>
        }

        <!-- Add Product Form -->
        <div class="bg-white rounded-lg shadow mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Thêm sản phẩm mới</h3>
            </div>
            <div class="p-6">
                <form asp-action="CreateProduct" method="post" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tên sản phẩm</label>
                        <input name="Name" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Danh mục</label>
                        <select name="Category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                            <option value="">Chọn danh mục</option>
                            <option value="Coffee">Cà phê</option>
                            <option value="Tea">Trà</option>
                            <option value="Smoothie">Sinh tố</option>
                            <option value="Juice">Nước ép</option>
                        </select>
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mô tả</label>
                        <textarea name="Description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">URL hình ảnh</label>
                        <input name="Image" type="url" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Giá Size S</label>
                            <input name="PriceS" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Giá Size M</label>
                            <input name="PriceM" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Giá Size L</label>
                            <input name="PriceL" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                    </div>
                    
                    <div class="md:col-span-2">
                        <button type="submit" class="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 transition-colors">
                            <i data-lucide="plus" class="h-4 w-4 inline mr-2"></i>
                            Thêm sản phẩm
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Products List -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Danh sách sản phẩm (@Model.Count)</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sản phẩm</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Danh mục</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Giá</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        @foreach (var product in Model)
                        {
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <img src="@product.Image" alt="@product.Name" class="w-12 h-12 rounded-lg object-cover">
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900">@product.Name</div>
                                            <div class="text-sm text-gray-500">@product.Description?.Substring(0, Math.Min(50, product.Description.Length))...</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                                        @(product.Category == ProductCategory.Coffee ? "Cà phê" :
                                          product.Category == ProductCategory.Tea ? "Trà" :
                                          product.Category == ProductCategory.Smoothie ? "Sinh tố" : "Nước ép")
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <div>S: @product.PriceS.ToString("N0") đ</div>
                                    <div>M: @product.PriceM.ToString("N0") đ</div>
                                    <div>L: @product.PriceL.ToString("N0") đ</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full @(product.Available ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800")">
                                        @(product.Available ? "Còn hàng" : "Hết hàng")
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button onclick="toggleAvailability('@product.Id', @product.Available.ToString().ToLower())" 
                                            class="text-blue-600 hover:text-blue-900 mr-3">
                                        @(product.Available ? "Ẩn" : "Hiện")
                                    </button>
                                    <button onclick="deleteProduct('@product.Id')" 
                                            class="text-red-600 hover:text-red-900">
                                        Xóa
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleAvailability(productId, currentStatus) {
            const newStatus = !currentStatus;
            
            $.post('/Admin/UpdateProduct', {
                Id: productId,
                Available: newStatus
            }, function(response) {
                if (response.success) {
                    location.reload();
                } else {
                    alert('Có lỗi xảy ra: ' + response.message);
                }
            });
        }
        
        function deleteProduct(productId) {
            if (confirm('Bạn có chắc muốn xóa sản phẩm này?')) {
                $.post('/Admin/DeleteProduct', {
                    id: productId
                }, function(response) {
                    if (response.success) {
                        location.reload();
                    } else {
                        alert('Có lỗi xảy ra: ' + response.message);
                    }
                });
            }
        }
        
        $(document).ready(function() {
            lucide.createIcons();
        });
    </script>
}